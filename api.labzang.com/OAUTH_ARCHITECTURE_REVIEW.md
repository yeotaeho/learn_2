# OAuth ì¸ì¦ êµ¬ì¡° ì ê²€ ë³´ê³ ì„œ

## ðŸ“‹ í˜„ìž¬ êµ¬ì¡° ë¶„ì„

### âœ… ì˜¬ë°”ë¥¸ êµ¬ì¡° í™•ì¸

í˜„ìž¬ ì‹œìŠ¤í…œì€ **"ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ ë°›ì•„ì„œ JWT í† í°ì„ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬í•˜ëŠ” êµ¬ì¡°"**ê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.

---

## ðŸ”„ ì¸ì¦ í”Œë¡œìš° ìƒì„¸ ë¶„ì„

### 1. êµ¬ê¸€ OAuth í”Œë¡œìš°

```
[í”„ë¡ íŠ¸ì—”ë“œ]                    [ë°±ì—”ë“œ]                    [êµ¬ê¸€ ë¦¬ì†ŒìŠ¤ ì„œë²„]
     |                              |                              |
     |-- 1. GET /api/auth/google/auth-url -->|                    |
     |<-- 2. {auth_url} ------------|                              |
     |                              |                              |
     |-- 3. ë¦¬ë‹¤ì´ë ‰íŠ¸ (êµ¬ê¸€ ë¡œê·¸ì¸) ------------------------->|
     |                              |                              |
     |<-- 4. GET /callback?code=xxx ------------------------------|
     |                              |                              |
     |                              |-- 5. POST /token (code) -->|
     |                              |<-- 6. {access_token, refresh_token} --|
     |                              |                              |
     |                              |-- 7. GET /userinfo (access_token) -->|
     |                              |<-- 8. {user_info} -----------|
     |                              |                              |
     |                              | [Redis ì €ìž¥]                 |
     |                              | - oauth:google:{userId}:access (êµ¬ê¸€ ì›ë³¸ í† í°)
     |                              | - oauth:google:{userId}:refresh (êµ¬ê¸€ ì›ë³¸ í† í°)
     |                              | - token:google:{userId}:access (JWT)
     |                              | - token:google:{userId}:refresh (JWT)
     |                              |                              |
     |<-- 9. ë¦¬ë‹¤ì´ë ‰íŠ¸ (JWT í† í°) --|                              |
     |    ?token={jwt_access_token}&refresh_token={jwt_refresh_token}|
```

**êµ¬í˜„ ìƒíƒœ:**
- âœ… êµ¬ê¸€ ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ Authorization Code ë°›ìŒ
- âœ… ë°±ì—”ë“œì—ì„œ êµ¬ê¸€ Access Token/Refresh Token êµí™˜
- âœ… êµ¬ê¸€ ì›ë³¸ í† í°ì„ Redisì— ì €ìž¥ (`oauth:google:{userId}:access/refresh`)
- âœ… ìžì²´ JWT í† í° ìƒì„±
- âœ… JWT í† í°ì„ Redisì— ì €ìž¥ (`token:google:{userId}:access/refresh`)
- âœ… JWT í† í°ì„ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬

---

### 2. ì¹´ì¹´ì˜¤ OAuth í”Œë¡œìš°

```
[í”„ë¡ íŠ¸ì—”ë“œ]                    [ë°±ì—”ë“œ]                    [ì¹´ì¹´ì˜¤ ë¦¬ì†ŒìŠ¤ ì„œë²„]
     |                              |                              |
     |-- 1. GET /oauth2/kakao/auth-url -->|                        |
     |<-- 2. {auth_url} ------------|                              |
     |                              |                              |
     |-- 3. ë¦¬ë‹¤ì´ë ‰íŠ¸ (ì¹´ì¹´ì˜¤ ë¡œê·¸ì¸) ------------------------->|
     |                              |                              |
     |<-- 4. GET /callback?code=xxx ------------------------------|
     |                              |                              |
     |-- 5. POST /api/auth/kakao/token (code) -->|                |
     |                              |                              |
     |                              |-- 6. POST /token (code) -->|
     |                              |<-- 7. {access_token, refresh_token} --|
     |                              |                              |
     |                              |-- 8. GET /userinfo (access_token) -->|
     |                              |<-- 9. {user_info} -----------|
     |                              |                              |
     |                              | [Redis ì €ìž¥]                 |
     |                              | - oauth:kakao:{userId}:access (ì¹´ì¹´ì˜¤ ì›ë³¸ í† í°)
     |                              | - oauth:kakao:{userId}:refresh (ì¹´ì¹´ì˜¤ ì›ë³¸ í† í°)
     |                              | - token:kakao:{userId}:access (JWT)
     |                              | - token:kakao:{userId}:refresh (JWT)
     |                              |                              |
     |<-- 10. {access_token, refresh_token} (JWT) --|              |
```

**êµ¬í˜„ ìƒíƒœ:**
- âœ… ì¹´ì¹´ì˜¤ ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ Authorization Code ë°›ìŒ
- âœ… ë°±ì—”ë“œì—ì„œ ì¹´ì¹´ì˜¤ Access Token/Refresh Token êµí™˜
- âœ… ì¹´ì¹´ì˜¤ ì›ë³¸ í† í°ì„ Redisì— ì €ìž¥ (`oauth:kakao:{userId}:access/refresh`) **[ìˆ˜ì • ì™„ë£Œ]**
- âœ… ìžì²´ JWT í† í° ìƒì„±
- âœ… JWT í† í°ì„ Redisì— ì €ìž¥ (`token:kakao:{userId}:access/refresh`)
- âœ… JWT í† í°ì„ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬

---

## ðŸ“¦ Redis ì €ìž¥ êµ¬ì¡°

### í† í° ì €ìž¥ í‚¤ íŒ¨í„´

#### 1. OAuth ì œê³µìž ì›ë³¸ í† í° (ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ ë°›ì€ í† í°)
```
oauth:{provider}:{userId}:access   â†’ OAuth ì œê³µìž Access Token
oauth:{provider}:{userId}:refresh  â†’ OAuth ì œê³µìž Refresh Token
```

**ì˜ˆì‹œ:**
- `oauth:google:109254451252513292479:access` â†’ êµ¬ê¸€ Access Token
- `oauth:google:109254451252513292479:refresh` â†’ êµ¬ê¸€ Refresh Token
- `oauth:kakao:123456789:access` â†’ ì¹´ì¹´ì˜¤ Access Token
- `oauth:kakao:123456789:refresh` â†’ ì¹´ì¹´ì˜¤ Refresh Token

#### 2. ìžì²´ JWT í† í° (ë°±ì—”ë“œì—ì„œ ìƒì„±í•œ í† í°)
```
token:{provider}:{userId}:access   â†’ JWT Access Token
token:{provider}:{userId}:refresh  â†’ JWT Refresh Token
```

**ì˜ˆì‹œ:**
- `token:google:109254451252513292479:access` â†’ JWT Access Token
- `token:google:109254451252513292479:refresh` â†’ JWT Refresh Token
- `token:kakao:123456789:access` â†’ JWT Access Token
- `token:kakao:123456789:refresh` â†’ JWT Refresh Token

---

## âœ… êµ¬ì¡° ê²€ì¦ ê²°ê³¼

### ì˜¬ë°”ë¥¸ ì 

1. **ë¦¬ì†ŒìŠ¤ ì„œë²„ í†µì‹ **: âœ…
   - êµ¬ê¸€/ì¹´ì¹´ì˜¤ ë¦¬ì†ŒìŠ¤ ì„œë²„ì™€ ì§ì ‘ í†µì‹ í•˜ì—¬ í† í° êµí™˜
   - ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ

2. **í† í° ì €ìž¥**: âœ…
   - OAuth ì œê³µìž ì›ë³¸ í† í° ì €ìž¥ (ì¶”ê°€ API í˜¸ì¶œìš©)
   - ìžì²´ JWT í† í° ì €ìž¥ (ì¸ì¦ìš©)

3. **í”„ë¡ íŠ¸ì—”ë“œ ì „ë‹¬**: âœ…
   - JWT í† í°ë§Œ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬
   - OAuth ì›ë³¸ í† í°ì€ ë°±ì—”ë“œì—ë§Œ ì €ìž¥ (ë³´ì•ˆ)

4. **í† í° ë§Œë£Œ ì‹œê°„**: âœ…
   - OAuth ì›ë³¸ í† í°: ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ ë°›ì€ `expires_in` ì‚¬ìš©
   - JWT í† í°: ìžì²´ ì„¤ì • (Access: 1ì‹œê°„, Refresh: 30ì¼)

---

## ðŸ” ê°œì„  ì‚¬í•­ (ì™„ë£Œ)

### ì¹´ì¹´ì˜¤ OAuth ì›ë³¸ í† í° ì €ìž¥ ì¶”ê°€
- **ì´ì „**: ì¹´ì¹´ì˜¤ ì›ë³¸ í† í°ì„ Redisì— ì €ìž¥í•˜ì§€ ì•ŠìŒ
- **ìˆ˜ì •**: êµ¬ê¸€ê³¼ ë™ì¼í•˜ê²Œ ì¹´ì¹´ì˜¤ ì›ë³¸ í† í°ë„ Redisì— ì €ìž¥
- **ì´ìœ **: í–¥í›„ ì¹´ì¹´ì˜¤ API ì¶”ê°€ í˜¸ì¶œ ì‹œ ì›ë³¸ í† í° í•„ìš”

---

## ðŸ“Š ìµœì¢… êµ¬ì¡° ìš”ì•½

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    í”„ë¡ íŠ¸ì—”ë“œ (Next.js)                      â”‚
â”‚  - JWT Access Token ì €ìž¥                                    â”‚
â”‚  - JWT Refresh Token ì €ìž¥                                   â”‚
â”‚  - API ìš”ì²­ ì‹œ JWT í† í° ì‚¬ìš©                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ JWT í† í°ë§Œ ì „ë‹¬
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              ë°±ì—”ë“œ (oauthservice)                            â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  OAuth ì½œë°± ì²˜ë¦¬                                     â”‚    â”‚
â”‚  â”‚  1. ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ í† í° êµí™˜                        â”‚    â”‚
â”‚  â”‚  2. ì‚¬ìš©ìž ì •ë³´ ì¡°íšŒ                                 â”‚    â”‚
â”‚  â”‚  3. OAuth ì›ë³¸ í† í° â†’ Redis ì €ìž¥                    â”‚    â”‚
â”‚  â”‚  4. JWT í† í° ìƒì„±                                    â”‚    â”‚
â”‚  â”‚  5. JWT í† í° â†’ Redis ì €ìž¥                           â”‚    â”‚
â”‚  â”‚  6. JWT í† í° â†’ í”„ë¡ íŠ¸ì—”ë“œ ì „ë‹¬                      â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚  Redis ì €ìž¥ì†Œ                                        â”‚    â”‚
â”‚  â”‚  - oauth:{provider}:{userId}:access/refresh        â”‚    â”‚
â”‚  â”‚  - token:{provider}:{userId}:access/refresh        â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                       â”‚
                       â”‚ OAuth í† í° êµí™˜
                       â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚          ë¦¬ì†ŒìŠ¤ ì„œë²„ (êµ¬ê¸€/ì¹´ì¹´ì˜¤)                            â”‚
â”‚  - Authorization Code â†’ Access Token êµí™˜                   â”‚
â”‚  - Access Tokenìœ¼ë¡œ ì‚¬ìš©ìž ì •ë³´ ì œê³µ                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## âœ… ìµœì¢… ê²€ì¦

### êµ¬ì¡° ì •í™•ì„±: âœ… **ì˜¬ë°”ë¦„**

1. **ë¦¬ì†ŒìŠ¤ ì„œë²„ í†µì‹ **: âœ… ë°±ì—”ë“œì—ì„œ ì§ì ‘ ì²˜ë¦¬
2. **í† í° ì €ìž¥**: âœ… OAuth ì›ë³¸ + JWT ëª¨ë‘ Redis ì €ìž¥
3. **í”„ë¡ íŠ¸ì—”ë“œ ì „ë‹¬**: âœ… JWT í† í°ë§Œ ì „ë‹¬ (ë³´ì•ˆ)
4. **ì¼ê´€ì„±**: âœ… êµ¬ê¸€/ì¹´ì¹´ì˜¤ ë™ì¼í•œ êµ¬ì¡°

### ë³´ì•ˆ ì¸¡ë©´

- âœ… OAuth ì›ë³¸ í† í°ì€ ë°±ì—”ë“œì—ë§Œ ì €ìž¥ (í”„ë¡ íŠ¸ì—”ë“œ ë…¸ì¶œ ì—†ìŒ)
- âœ… í”„ë¡ íŠ¸ì—”ë“œëŠ” JWT í† í°ë§Œ ì‚¬ìš©
- âœ… JWT í† í°ì€ ìžì²´ ì„œëª…ìœ¼ë¡œ ê²€ì¦ ê°€ëŠ¥

### í™•ìž¥ì„±

- âœ… ìƒˆë¡œìš´ OAuth ì œê³µìž ì¶”ê°€ ì‹œ ë™ì¼í•œ íŒ¨í„´ ì ìš© ê°€ëŠ¥
- âœ… OAuth ì›ë³¸ í† í° ì €ìž¥ìœ¼ë¡œ í–¥í›„ ì¶”ê°€ API í˜¸ì¶œ ê°€ëŠ¥

---

## ðŸ“ ê²°ë¡ 

**í˜„ìž¬ êµ¬ì¡°ëŠ” "ë¦¬ì†ŒìŠ¤ ì„œë²„ì—ì„œ ë°›ì•„ì„œ JWT í† í°ì„ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬í•˜ëŠ” êµ¬ì¡°"ê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.**

- âœ… ë¦¬ì†ŒìŠ¤ ì„œë²„(êµ¬ê¸€/ì¹´ì¹´ì˜¤)ì™€ ì§ì ‘ í†µì‹ 
- âœ… OAuth ì›ë³¸ í† í°ì„ Redisì— ì•ˆì „í•˜ê²Œ ì €ìž¥
- âœ… ìžì²´ JWT í† í° ìƒì„± ë° ì €ìž¥
- âœ… JWT í† í°ë§Œ í”„ë¡ íŠ¸ì—”ë“œë¡œ ì „ë‹¬
- âœ… êµ¬ê¸€/ì¹´ì¹´ì˜¤ ëª¨ë‘ ë™ì¼í•œ êµ¬ì¡°ë¡œ ì¼ê´€ì„± ìœ ì§€

**ì¶”ê°€ ê°œì„  ì‚¬í•­ ì—†ìŒ** - êµ¬ì¡°ê°€ ì˜¬ë°”ë¥´ê²Œ êµ¬í˜„ë˜ì–´ ìžˆìŠµë‹ˆë‹¤.

